import vk_api
from vk_api.bot_longpoll import VkBotLongPoll, VkBotEventType
import random
import os
import time

print("üîÑ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –¥–ª—è –º–∞–π–Ω–∫—Ä–∞—Ñ—Ç —Å–µ—Ä–≤–µ—Ä–∞...")

# –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ (–±—É–¥—É—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è Heroku)
GROUP_ID = os.environ.get('GROUP_ID', '234268176')  # –í–∞—à ID –≥—Ä—É–ø–ø—ã
TOKEN = os.environ.get('TOKEN', 'vk1.a.PG52Lss5mcUsbIg4bhSpSx4Ce-ibEsD2MRVW_LBJuO4GgC6laRrQANNexgsrDB_GLOFJK33WgxtfzInlb5SpbJ6dv9eJf2xj6WejGTOPbtByjV-8HEX5Awg0E5SzJmNC3oAubSjJ0uIs9_4Cg6Cq-t0NHzSzAUwRllr5XHak8fOJ8XOshYBFJHhJltoL8h-yCmx-z7MW2n9daQmK-SHj5w')

print(f"üîß ID –≥—Ä—É–ø–ø—ã: {GROUP_ID}")

try:
    # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ VK
    vk_session = vk_api.VkApi(token=TOKEN)
    longpoll = VkBotLongPoll(vk_session, GROUP_ID)
    vk = vk_session.get_api()
    print("‚úÖ –£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ!")
except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: {e}")
    print("üí° –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –∏ ID –≥—Ä—É–ø–ø—ã")
    exit(1)

def send_message(user_id, message, keyboard=None):
    """–§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π"""
    try:
        vk.messages.send(
            user_id=user_id,
            message=message,
            random_id=random.randint(0, 2**64),
            keyboard=keyboard
        )
        return True
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: {e}")
        return False

# –°–æ–∑–¥–∞–µ–º –∫—Ä–∞—Å–∏–≤—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
keyboard = {
    "one_time": False,
    "inline": False,
    "buttons": [
        [{
            "action": {
                "type": "text",
                "payload": '{"button": "1"}',
                "label": "üì¢ –û–ø–æ–≤–µ—â–µ–Ω–∏—è"
            },
            "color": "positive"
        }],
        [{
            "action": {
                "type": "text", 
                "payload": '{"button": "2"}',
                "label": "üîÑ –ì—Ä–∞—Ñ–∏–∫ –≤–∞–π–ø–æ–≤"
            },
            "color": "primary"
        }],
        [{
            "action": {
                "type": "text",
                "payload": '{"button": "3"}', 
                "label": "üìñ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"
            },
            "color": "primary"
        }],
        [{
            "action": {
                "type": "text",
                "payload": '{"button": "4"}',
                "label": "üåê IP —Å–µ—Ä–≤–µ—Ä–æ–≤" 
            },
            "color": "secondary"
        }]
    ]
}

keyboard_json = str(keyboard).replace("'", '"')

print("üéâ –ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω!")
print("üì± –û–∂–∏–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∏–≥—Ä–æ–∫–æ–≤...")

# –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
while True:
    try:
        for event in longpoll.listen():
            if event.type == VkBotEventType.MESSAGE_NEW:
                msg_text = event.object.message['text']
                user_id = event.object.message['from_id']
                user_name = f"–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id}"
                
                print(f"üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç {user_name}: {msg_text}")
                
                # –ü—Ä–∏–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
                msg = msg_text.lower().strip()
                
                # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
                if msg in ['–Ω–∞—á–∞—Ç—å', 'start', '–ø—Ä–∏–≤–µ—Ç', 'hello', 'hi', '–∫—É', '–±–æ—Ç']:
                    welcome_text = """üéÆ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –Ω–∞—à Minecraft —Å–µ—Ä–≤–µ—Ä!

–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ù–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π —Ä–∞–∑–¥–µ–ª:"""
                    send_message(user_id, welcome_text, keyboard_json)
                    print(f"‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–ª—è {user_name}")
                
                # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫
                elif msg in ['–æ–ø–æ–≤–µ—â–µ–Ω–∏—è', 'üì¢ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è']:
                    response = """üì¢ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞:

‚Ä¢ üéâ –ó–∞–ø—É—â–µ–Ω–∞ –Ω–æ–≤–∞—è –∏–≤–µ–Ω—Ç-—Å–∏—Å—Ç–µ–º–∞
‚Ä¢ ‚öîÔ∏è –î–æ–±–∞–≤–ª–µ–Ω—ã PvP –∞—Ä–µ–Ω—ã
‚Ä¢ üè∞ –û–±–Ω–æ–≤–ª–µ–Ω—ã –∑–∞—â–∏—Ç—ã —Ä–µ–≥–∏–æ–Ω–æ–≤
‚Ä¢ üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–∑—ã
‚Ä¢ üìà –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–°–ª–µ–¥–∏—Ç–µ –∑–∞ –Ω–æ–≤–æ—Å—Ç—è–º–∏!"""
                    send_message(user_id, response, keyboard_json)
                    print(f"‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –¥–ª—è {user_name}")
                
                elif msg in ['–≥—Ä–∞—Ñ–∏–∫ –≤–∞–π–ø–æ–≤', 'üîÑ –≥—Ä–∞—Ñ–∏–∫ –≤–∞–π–ø–æ–≤', '–≤–∞–π–ø', '–∫–æ–≥–¥–∞ –≤–∞–π–ø']:
                    response = """üîÑ –ì—Ä–∞—Ñ–∏–∫ –≤–∞–π–ø–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞:

üìÖ –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –≤–∞–π–ø—ã:
‚Ä¢ –ö–∞–∂–¥–æ–µ 1-–µ —á–∏—Å–ª–æ –º–µ—Å—è—Ü–∞
‚Ä¢ –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
‚Ä¢ –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ—Å—Ç—Ä–æ–π–∫–∏ –∏ –≤–µ—â–∏

üìÖ –ü–æ–ª–Ω—ã–µ –≤–∞–π–ø—ã:
‚Ä¢ –ö–∞–∂–¥—ã–µ 3 –º–µ—Å—è—Ü–∞
‚Ä¢ –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –∫–∞—Ä—Ç—ã
‚Ä¢ –ù–æ–≤—ã–π –º–∏—Ä, –Ω–æ–≤—ã–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è

üéØ –ë–ª–∏–∂–∞–π—à–∏–π –≤–∞–π–ø:
‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π: 1 –¥–µ–∫–∞–±—Ä—è 2024
‚Ä¢ –ü–æ–ª–Ω—ã–π: 1 —è–Ω–≤–∞—Ä—è 2025

–°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º–∏!"""
                    send_message(user_id, response, keyboard_json)
                    print(f"‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω –≥—Ä–∞—Ñ–∏–∫ –≤–∞–π–ø–æ–≤ –¥–ª—è {user_name}")
                
                elif msg in ['–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', 'üìñ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', '–∏–Ω—Ñ–∞', '–æ —Å–µ—Ä–≤–µ—Ä–µ']:
                    response = """üìñ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ:

üéÆ –í–µ—Ä—Å–∏—è: Minecraft 1.20.1
üë• –û–Ω–ª–∞–π–Ω: 45/100 –∏–≥—Ä–æ–∫–æ–≤
‚≠ê –†–µ–π—Ç–∏–Ω–≥: 4.8/5 –∑–≤–µ–∑–¥

‚ö° –û—Å–Ω–æ–≤–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
‚Ä¢ –†–µ–∂–∏–º: –í—ã–∂–∏–≤–∞–Ω–∏–µ —Å –∫–ª–∞–Ω–∞–º–∏
‚Ä¢ –≠–∫–æ–Ω–æ–º–∏–∫–∞: –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –≤–∞–ª—é—Ç–∞
‚Ä¢ PvP: —Å –∑–∞—â–∏—â–µ–Ω–Ω—ã–º–∏ –∑–æ–Ω–∞–º–∏
‚Ä¢ –ö–ª–∞–Ω—ã: —Å–∏—Å—Ç–µ–º—ã –≤–æ–π–Ω –∏ –∞–ª—å—è–Ω—Å–æ–≤
‚Ä¢ –ö–≤–µ—Å—Ç—ã: –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è
‚Ä¢ –ú–∞–≥–∞–∑–∏–Ω: /shop –≤ –∏–≥—Ä–µ

üéÅ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ñ–∏—á–∏:
‚Ä¢ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç
‚Ä¢ –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–æ–±—ã
‚Ä¢ –°–µ–∑–æ–Ω–Ω—ã–µ –∏–≤–µ–Ω—Ç—ã
‚Ä¢ –†–µ–π—Ç–∏–Ω–≥–∏ –∏ —Ç–æ–ø—ã"""
                    send_message(user_id, response, keyboard_json)
                    print(f"‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è {user_name}")
                
                elif msg in ['ip —Å–µ—Ä–≤–µ—Ä–æ–≤', 'üåê ip —Å–µ—Ä–≤–µ—Ä–æ–≤', 'ip', '–∞–π–ø–∏', '–∫–æ–Ω–Ω–µ–∫—Ç']:
                    response = """üåê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É:

üì° –û—Å–Ω–æ–≤–Ω–æ–π IP –∞–¥—Ä–µ—Å:
‚Ä¢ mc.rustcraft.ru:25565

üõ°Ô∏è –†–µ–∑–µ—Ä–≤–Ω—ã–π IP:
‚Ä¢ backup.rustcraft.ru:25565

üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
‚Ä¢ –í–µ—Ä—Å–∏—è: 1.20.1
‚Ä¢ –†–µ–∂–∏–º: –í—ã–∂–∏–≤–∞–Ω–∏–µ
‚Ä¢ –û–Ω–ª–∞–π–Ω: 45/100

üí° –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è:
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Minecraft
2. –í—ã–±–µ—Ä–∏—Ç–µ "–°–µ—Ç–µ–≤–∞—è –∏–≥—Ä–∞"
3. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä"
4. –í–≤–µ–¥–∏—Ç–µ IP: mc.rustcraft.ru
5. –ù–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –∏–≥—Ä–æ–π!

üì¢ –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø–∏—à–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏."""
                    send_message(user_id, response, keyboard_json)
                    print(f"‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã IP –∞–¥—Ä–µ—Å–∞ –¥–ª—è {user_name}")
                
                else:
                    # –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞
                    help_text = "‚ùì –Ø –Ω–µ –ø–æ–Ω—è–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å.\n\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ '–Ω–∞—á–∞—Ç—å' –¥–ª—è –≤—ã–∑–æ–≤–∞ –º–µ–Ω—é."
                    send_message(user_id, help_text, keyboard_json)
                    print(f"‚ÑπÔ∏è  –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –æ—Ç {user_name}: {msg_text}")
    
    except Exception as e:
        print(f"‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {e}")
        print("üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥...")
        time.sleep(10)
